pipeline {
    agent none

    stages {
        stage('Start VM') {
            steps {
                script {
                    def vmName = 'JenkinSlave'  // Replace with your VM's name
                    def vmState = sh(script: "VBoxManage showvminfo ${vmName} --machinereadable | grep '^VMState=' | cut -d'=' -f2", returnStatus: true).trim()
                    if (vmState == 'running') {
                        echo "VM '${vmName}' is already running."
                    } else {
                        sh "VBoxManage startvm ${vmName} --type headless"
                        echo "Started VM '${vmName}'."
                    }
                }
            }
        }

        stage('Build') {
            when {
                expression { currentBuild.resultIsBetterOrEqualTo('SUCCESS') }
            }
            agent {
                label 'UbuntuJenkinSlave'  // Replace with your agent label
            }
            steps {
                sh 'python3 --version'
            }
        }
    }

    post {
        success {
            // This block will be executed if the pipeline is successful
            echo 'Pipeline successfully completed!'
        }
        failure {
            // This block will be executed if the pipeline fails
            echo 'Pipeline failed. Please check the build and deployment logs.'
        }
    }
}
